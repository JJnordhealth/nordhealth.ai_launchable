---
import type { Lang } from '../i18n';

interface Props {
  lang: Lang;
  t: any;
}

const { lang, t } = Astro.props;
---

<div class="cookie-banner" id="cookieBanner" role="dialog" aria-label="Cookie consent">
  <div class="cookie-banner-container">
    <div class="cookie-banner-content">
      <p class="cookie-banner-text">
        {t.cookie.text}
        {' '}{t.cookie.learnMore}{' '}<a href={`/nora/${lang}/privacy`}>{t.cookie.privacyPolicy}</a>.
      </p>
    </div>
    <div class="cookie-banner-actions">
      <button class="cookie-btn cookie-btn-decline" id="cookieDecline">{t.cookie.decline}</button>
      <button class="cookie-btn cookie-btn-accept" id="cookieAccept">{t.cookie.accept}</button>
    </div>
  </div>
</div>

<script>
  (function() {
    var banner = document.getElementById('cookieBanner');
    var acceptBtn = document.getElementById('cookieAccept');
    var declineBtn = document.getElementById('cookieDecline');

    var hasConsent = false;
    try {
      hasConsent = localStorage.getItem('cookieConsent');
    } catch (e) {}

    if (!hasConsent) {
      setTimeout(function() {
        banner?.classList.add('visible');
      }, 500);
    }

    acceptBtn?.addEventListener('click', function() {
      try { localStorage.setItem('cookieConsent', 'accepted'); } catch (e) {}
      banner?.classList.remove('visible');
      if (typeof loadAnalytics === 'function') loadAnalytics();
    });

    declineBtn?.addEventListener('click', function() {
      try { localStorage.setItem('cookieConsent', 'declined'); } catch (e) {}
      banner?.classList.remove('visible');
    });
  })();
</script>
